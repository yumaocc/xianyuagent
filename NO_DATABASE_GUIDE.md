# 🚀 无数据库版本使用指南

## 📋 版本对比

| 功能特性 | 数据库版本 | 简化版本 | 说明 |
|---------|------------|----------|------|
| 💬 智能对话 | ✅ | ✅ | 完全相同 |
| 💰 议价统计 | ✅ | ✅ | 完全相同 |
| 👨‍💼 人工接管 | ✅ | ✅ | 完全相同 |
| 📦 商品缓存 | ✅ | ✅ | 完全相同 |
| 💾 数据持久化 | SQLite数据库 | JSON文件 | 功能一样，存储方式不同 |
| 🖥️ Web管理界面 | ✅ | ❌ | 简化版不包含Web界面 |
| 📊 数据分析 | ✅ | ❌ | 简化版不支持复杂查询 |
| 🚀 部署难度 | 中等 | 极简 | 简化版无需配置数据库 |
| 💻 资源消耗 | 中等 | 很低 | 简化版占用更少内存 |

## 🎯 适用场景

### ✅ **选择简化版的情况**
- 个人卖家，商品数量不多
- 对话量不大（每天100条以内）  
- 追求简单部署和维护
- 不需要复杂的数据分析
- 服务器资源有限

### 🏢 **选择数据库版本的情况**
- 多个店铺或大量商品
- 对话量很大（每天1000条以上）
- 需要Web管理界面
- 需要详细的数据分析和报表
- 有团队协作需求

## 🚀 快速开始（简化版）

### 1. 环境要求
- Python 3.8+
- 无需数据库软件

### 2. 安装依赖
```bash
pip install -r requirements.txt
```

### 3. 配置环境变量
创建 `.env` 文件：
```env
# 必需配置
API_KEY=your_api_key
COOKIES_STR=your_xianyu_cookies
MODEL_BASE_URL=https://dashscope.aliyuncs.com/compatible-mode/v1
MODEL_NAME=qwen-max

# 可选配置
TOGGLE_KEYWORDS=。
LOG_LEVEL=INFO
```

### 4. 启动程序
```bash
python main.py
```

> **注意**: 程序会自动检测SQLite是否可用，如果不可用会自动切换到文件存储模式。无需手动配置！

## 📁 数据存储说明

### 数据文件位置
```
data/
├── chat_messages.json    # 对话历史记录
├── bargain_counts.json   # 议价次数统计
└── item_cache.json       # 商品信息缓存
```

### 数据格式说明

**chat_messages.json** - 对话记录
```json
{
  "chat_id_123": [
    {
      "user_id": "buyer123",
      "item_id": "item456",
      "role": "user",
      "content": "这个多少钱？",
      "timestamp": "2024-01-01T12:00:00"
    }
  ]
}
```

**bargain_counts.json** - 议价统计
```json
{
  "chat_id_123": 3,
  "chat_id_456": 1
}
```

**item_cache.json** - 商品缓存  
```json
{
  "item456": {
    "desc": "商品描述",
    "soldPrice": 299,
    "title": "商品标题",
    "cached_time": "2024-01-01T12:00:00"
  }
}
```

## 🔧 功能特性

### ✅ **保留的核心功能**
1. **智能对话**：完全相同的AI回复质量
2. **专家路由**：议价专家、技术专家、默认客服
3. **议价统计**：自动跟踪议价轮次，动态调整策略
4. **商品缓存**：减少API调用，提升响应速度
5. **人工接管**：发送"。"切换人工/自动模式
6. **数据持久化**：重启后数据不丢失

### 🔄 **自动数据管理**
- **实时保存**：每次对话自动保存到文件
- **内存优化**：限制内存中的对话数量（默认30条）
- **文件备份**：重要数据多文件分别存储
- **启动恢复**：程序重启后自动从文件恢复数据

### 📊 **内置统计功能**
启动时显示数据统计：
```
📊 加载数据: 15个会话, 89条消息, 12个商品缓存
```

## 🛠️ 维护和管理

### 查看数据统计
```python
# 在程序运行时，会自动显示统计信息
stats = context_manager.get_stats()
print(f"总会话数: {stats['total_conversations']}")
print(f"总消息数: {stats['total_messages']}")  
print(f"缓存商品: {stats['cached_items']}")
print(f"活跃议价: {stats['active_bargains']}")
```

### 清理旧数据（可选）
```python
# 清理30天前的数据
context_manager.cleanup_old_data(days=30)
```

### 手动备份数据
```bash
# 备份整个data目录
cp -r data/ backup_$(date +%Y%m%d)/
```

## ⚠️ 注意事项

### 性能限制
- **对话数量**：建议不超过1000个活跃会话
- **消息数量**：建议每个会话不超过30条历史消息
- **文件大小**：JSON文件过大时可能影响加载速度

### 数据安全
- **定期备份**：重要数据建议每周备份
- **权限控制**：确保data目录的读写权限
- **磁盘空间**：预留足够的存储空间

### 升级到数据库版本
如果后续需要升级到数据库版本，可以：
1. 保留现有JSON数据文件
2. 编写数据迁移脚本将JSON导入SQLite
3. 切换到 `main.py` 启动

## 🔄 版本切换

### 存储模式自动切换
程序启动时会自动检测：
- **SQLite可用** → 使用数据库存储
- **SQLite不可用** → 自动切换到文件存储

```bash
# 统一启动命令
python main.py
```

如需强制使用文件模式，可以在代码中设置 `force_file_mode=True`。

## 🎉 总结

简化版XianyuAutoAgent提供了与数据库版本几乎相同的核心功能，但去除了复杂的数据库配置和Web管理界面。

**🎯 核心优势**：
- ✅ **零配置**：无需安装和配置数据库
- ✅ **轻量级**：内存占用更少，启动更快
- ✅ **易维护**：数据文件直观，便于查看和备份
- ✅ **全功能**：保留所有核心的AI客服功能

**适合95%的个人卖家使用！** 🚀